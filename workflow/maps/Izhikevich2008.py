import numpy as np
import h5py
import numpy as np

num_sources = 11    # L1 L23E L23I L4E L4I L5E L5I L6E L6I CC TH
num_targets = 9     # L1 L23E L23I L4E L4I L5E L5I L6E L6I
num_layers  = 5     # L1 L23 L4 L5 L6

MAP = np.zeros((num_layers, num_targets, num_sources))
from tabulate import tabulate

# L1
MAP[0] = np.array([[0.000000000, 1,	       1,	        1,	         1,	          1,	       0,	        1,	        1,	         0,	          0],
                   [0.273312458, 0.960270254, 0.971773961,	0.997379993, 1,	          0.994649909, 0,           1,          1,           0.270480932, 0.26463964],
                   [0,           0,	       0,	        0,	         0,	          0,	       0,	        0,	        0,	         0,	          0],
                   [0,           0.18847326,  0.163232861,	0.193472163, 0.195702094, 0.216086827, 0,	        0.19405273,	0.200779364, 0.195175754, 0.194758439],
                   [0,           0,	       0,	        0,           0,	          0,	       0,	        0,	        0,	         0,	          0],
                   [1,           0.063841964, 0.162608565,	0.003382068, 0,	          0.004355734,	0,	        0,	        0,	         0.805517379, 0.71240417],
                   [0,           0,	       0,	        0,	         0,	          0,	       0,	        0,	        0,	         0,	          0],
                   [1,           0.003363875, 0.008486079,	6.65584E-05, 0,	          9.34302E-05,	0,	        0,	        0,	         0.008592934, 0.006561643],
                   [0,           0,	       0,	        0,	         0,	          0,	       0,	        0,	        0,	         0,	          0]])

# L23
MAP[1] = np.array([[0,           0,           0,           0,           0,           0,           0, 0, 0, 0, 0],
                   [0.726687542, 0.039729746, 0.028226039, 0.002620007, 0,           0.005350091, 0, 0, 0, 0.729519068, 0.73536036],
                   [1,           1,           1,           1,           1,           1,           0, 1, 1, 1, 1],
                   [0,           0.243404442, 0.24280523,  0.192851088, 0.194068325, 0.197799584, 0, 0.189989141, 0.185604687, 0.188806468, 0.193132549],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0.194686175, 0.379568409, 0.163726723, 0.061745821, 0.103441798, 0, 0.049725462, 0.012112588, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0.221172602, 0.427087017, 0.06947085, 0.014908425, 0.047839276, 0, 0.004920858, 0.001965055, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])

# L4
MAP[2] = np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0.568122298, 0.593961909, 0.613676749, 0.610229581, 0.586113589, 0, 0.615958128, 0.613615948, 0.616017778, 0.612109012],
                   [0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1],
                   [0, 0.005982718, 0.022857408, 0.144048445, 0.477491757, 0.008265683, 0, 0.464198227, 0.061863391, 0.056614605, 0.117237729],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0.052037573, 0.196913531, 0.467965557, 0.882698413, 0.029267763, 0, 0.351712434, 0.076841138, 0.099696511, 0.178253653],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])

# L5
MAP[3] = np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0.735489142, 0.434965619, 0.688842763, 0.460762423, 0.883936785, 1, 0.486076312, 0.926024021, 0.137868016, 0.170358101],
                   [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                   [0, 0.533228381, 0.16599181, 0.187475644, 0.048461538, 0.257184707, 0.411380597, 0.028152625, 0.093419178, 0.017395893, 0.017075242],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]])

# L6
MAP[4] = np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                   [0, 0.19019757, 0.201521563, 0.27502139, 0.053931624, 0.665614823, 0.588619403, 0.615214083, 0.827774629, 0.874314662, 0.798109462],
                   [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]])

# Print the formatted table
layers = ['L1', 'L23', 'L4', 'L5', 'L6']
table = []
for l in range(num_layers):
    table.append([layers[l]] + MAP[l].tolist())

print(tabulate(table, headers=['Layer'] + ['L1', 'L23E', 'L23I', 'L4E', 'L4I', 'L5E', 'L5I', 'L6E', 'L6I', 'CC', 'TH'], tablefmt='grid'))

hf = h5py.File('maps/curr_syn_map.h5', 'w')
hf.create_dataset('MAP', data=MAP)
hf.close()

if __name__=="__main__":

    import pylab as plt

    layers = ['L1', 'L23', 'L4', 'L5', 'L6']
    plt.figure(figsize=(10,10))
    for l in range(num_layers):
        plt.subplot(2, 3, l+1)
        im = plt.imshow(MAP[l, :, :], interpolation='nearest', cmap='Reds')
        plt.colorbar(im,fraction=0.046, pad=0.04)
        plt.title('Layer {}'.format(layers[l]))
        plt.xticks(np.arange(num_sources), ['L1', 'L23E', 'L23I', 'L4E', 'L4I', 'L5E', 'L5I', 'L6E', 'L6I', 'CC', 'TH'], rotation=90)
        plt.yticks(np.arange(num_targets), ['L1', 'L23E', 'L23I', 'L4E', 'L4I', 'L5E', 'L5I', 'L6E', 'L6I'])
        plt.xlabel('Source')
        plt.ylabel('Target')
    plt.suptitle('Probability of synapse from source to target in layer')
    plt.tight_layout(pad=1)
    plt.show()